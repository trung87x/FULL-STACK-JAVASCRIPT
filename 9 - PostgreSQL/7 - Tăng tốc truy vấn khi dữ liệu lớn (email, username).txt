# Ng·ªØ c·∫£nh 7: TƒÉng t·ªëc truy v·∫•n khi d·ªØ li·ªáu l·ªõn (email, username)

üß† Model (√ù nghƒ©a d·ªØ li·ªáu & quan h·ªá)
- Khi b·∫£ng c√≥ h√†ng ch·ª•c ng√†n ƒë·∫øn h√†ng tri·ªáu b·∫£n ghi, vi·ªác t√¨m ki·∫øm theo `email`, `username` s·∫Ω ch·∫≠m.
- Gi·∫£i ph√°p: t·∫°o ch·ªâ m·ª•c (`INDEX`) cho c√°c c·ªôt hay ƒë∆∞·ª£c t√¨m ki·∫øm, s·∫Øp x·∫øp ho·∫∑c JOIN.

üõ†Ô∏è Controller (SQL)

-- T·∫°o b·∫£ng users
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- T·∫°o ch·ªâ m·ª•c cho c·ªôt email (n·∫øu ch∆∞a c√≥ UNIQUE INDEX m·∫∑c ƒë·ªãnh)
CREATE INDEX idx_users_email ON users(email);

-- T·∫°o ch·ªâ m·ª•c cho c·ªôt name (t√¨m ki·∫øm t√™n nhanh h∆°n)
CREATE INDEX idx_users_name ON users(name);

-- Truy v·∫•n ng∆∞·ªùi d√πng theo email
SELECT * FROM users WHERE email = 'trung@example.com';

-- Truy v·∫•n ng∆∞·ªùi d√πng theo t√™n (LIKE)
SELECT * FROM users WHERE name ILIKE '%trung%';

-- Ki·ªÉm tra hi·ªáu su·∫•t truy v·∫•n
EXPLAIN ANALYZE SELECT * FROM users WHERE email = 'trung@example.com';

üìò Ghi ch√∫:
- `CREATE INDEX`: t·∫°o ch·ªâ m·ª•c th∆∞·ªùng (kh√¥ng UNIQUE)
- `UNIQUE INDEX`: ƒë∆∞·ª£c t·ª± ƒë·ªông t·∫°o khi d√πng `UNIQUE`
- `EXPLAIN ANALYZE`: ƒëo chi ti·∫øt hi·ªáu su·∫•t th·ª±c t·∫ø c·ªßa truy v·∫•n
- T·∫°o index cho c√°c c·ªôt th∆∞·ªùng d√πng trong: WHERE, JOIN, ORDER BY
- Kh√¥ng n√™n t·∫°o qu√° nhi·ªÅu index ‚Üí l√†m ch·∫≠m INSERT/UPDATE

